<!DOCTYPE html >
<html lang="en">
  
<!-- Mirrored from admin.pixelstrap.net/admiro/template/dashboard-02.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 18 Oct 2024 13:00:32 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Dashboard Admin Koperasi Menara Teknika BOE-Malang."/>
    <meta name="keywords" content="Boe-Malang, koperasi, Toko Penjualan, Produk, Kategori"/>
    <meta name="author" content="BOE-Malang"/>
    <title> {% block title %}DASHBOARD SYSTEM{% endblock %} </title>
     {% include 'includes/styles.html' %}
</head>
  <body>
    <!-- page-wrapper Start-->
    <!-- tap on top starts-->
    <div class="tap-top"><i class="iconly-Arrow-Up icli"></i></div>
    <!-- tap on tap ends-->
    <!-- loader-->
    <div class="loader-wrapper">
      <div class="loader"><span></span><span></span><span></span><span></span><span></span></div>
    </div>
    <div class="page-wrapper compact-wrapper" id="pageWrapper"> 
      <header class="page-header row">
        <div class="logo-wrapper d-flex align-items-center col-auto"><a href="/index">
          <img class="light-logo img-fluid"
               src="../static/img/logo-mt.png" alt="logo"/>
          <img class="dark-logo img-fluid" src="../static/img/logo-mt.png" alt="logo"/></a>
          <a class="close-btn toggle-sidebar" href="javascript:void(0)">
            <svg class="svg-color">
              <use href="../static/svg/iconly-sprite.svg#Category"></use>
            </svg></a></div>
        <div class="page-main-header col">
          <div class="header-left">
            <form class="form-inline search-full col" action="#" method="get">
              <div class="form-group w-100">
                <div class="Typeahead Typeahead--twitterUsers">
                  <div class="u-posRelative">
                    <input class="demo-input Typeahead-input form-control-plaintext w-100" type="text" placeholder="Search Admiro .." name="q" title="" autofocus="autofocus"/>
                    <div class="spinner-border Typeahead-spinner" role="status"><span class="sr-only">Loading...</span></div><i class="close-search" data-feather="x"></i>
                  </div>
                  <div class="Typeahead-menu"></div>
                </div>
              </div>
            </form>
            <div class="form-group-header d-lg-block d-none">
              <div class="Typeahead Typeahead--twitterUsers">
                <div class="u-posRelative d-flex align-items-center"> 
                  <input class="demo-input py-0 Typeahead-input form-control-plaintext w-100" type="text" placeholder="Type to Search..." name="q" title=""/><i class="search-bg iconly-Search icli"></i>
                </div>
              </div>
            </div>
          </div>
          <div class="nav-right">
            <ul class="header-right"> 
              <li class="custom-dropdown">
              </li>
              <li class="search d-lg-none d-flex"> <a href="javascript:void(0)">
                  <svg>
                    <use href="../static/svg/iconly-sprite.svg#Search"></use>
                  </svg></a>
              </li>
              <li>  <a class="dark-mode" href="javascript:void(0)">
                  <svg>
                    <use href="../static/svg/iconly-sprite.svg#moondark"></use>
                  </svg></a>
              </li>
              <li class="custom-dropdown"><a href="javascript:void(0)">
                  <svg>
                    <use href="../static/svg/iconly-sprite.svg#cart-icon"></use>
                  </svg></a><span class="badge rounded-pill badge-primary">2
              </span>
              </li>
              <li class="custom-dropdown"><a href="javascript:void(0)">
                  <svg>
                    <use href="../static/svg/iconly-sprite.svg#notification"></use>
                  </svg></a><span class="badge rounded-pill badge-primary">4</span>
              </li>
              <li><a class="full-screen" href="javascript:void(0)"> 
                  <svg>
                    <use href="../static/svg/iconly-sprite.svg#scanfull"></use>
                  </svg></a></li>
              <li class="custom-dropdown"><a href="javascript:void(0)">
                  <svg>
                    <use href="../static/svg/iconly-sprite.svg#bookmark"></use>
                  </svg></a>
              </li>
              <li class="cloud-design"><a class="cloud-mode">
                  <svg class="climacon climacon_cloudDrizzle" id="cloudDrizzle" version="1.1" viewBox="15 15 70 70">
                    <g class="climacon_iconWrap climacon_iconWrap-cloudDrizzle">
                      <g class="climacon_wrapperComponent climacon_wrapperComponent-drizzle">
                        <path class="climacon_component climacon_component-stroke climacon_component-stroke_drizzle climacon_component-stroke_drizzle-left" d="M42.001,53.644c1.104,0,2,0.896,2,2v3.998c0,1.105-0.896,2-2,2c-1.105,0-2.001-0.895-2.001-2v-3.998C40,54.538,40.896,53.644,42.001,53.644z"></path>
                        <path class="climacon_component climacon_component-stroke climacon_component-stroke_drizzle climacon_component-stroke_drizzle-middle" d="M49.999,53.644c1.104,0,2,0.896,2,2v4c0,1.104-0.896,2-2,2s-1.998-0.896-1.998-2v-4C48.001,54.54,48.896,53.644,49.999,53.644z"></path>
                        <path class="climacon_component climacon_component-stroke climacon_component-stroke_drizzle climacon_component-stroke_drizzle-right" d="M57.999,53.644c1.104,0,2,0.896,2,2v3.998c0,1.105-0.896,2-2,2c-1.105,0-2-0.895-2-2v-3.998C55.999,54.538,56.894,53.644,57.999,53.644z"></path>
                      </g>
                      <g class="climacon_wrapperComponent climacon_wrapperComponent-cloud">
                        <path class="climacon_component climacon_component-stroke climacon_component-stroke_cloud" d="M63.999,64.944v-4.381c2.387-1.386,3.998-3.961,3.998-6.92c0-4.418-3.58-8-7.998-8c-1.603,0-3.084,0.481-4.334,1.291c-1.232-5.316-5.973-9.29-11.664-9.29c-6.628,0-11.999,5.372-11.999,12c0,3.549,1.55,6.729,3.998,8.926v4.914c-4.776-2.769-7.998-7.922-7.998-13.84c0-8.836,7.162-15.999,15.999-15.999c6.004,0,11.229,3.312,13.965,8.203c0.664-0.113,1.336-0.205,2.033-0.205c6.627,0,11.998,5.373,11.998,12C71.997,58.864,68.655,63.296,63.999,64.944z"></path>
                      </g>
                    </g>
                  </svg>
                  <h3>15</h3></a></li>
              <li class="profile-nav custom-dropdown">
                <div class="user-wrap">
                  <div class="user-img"><img src="../static/assets/images/profile.png" alt="user"/></div>
                  <div class="user-content">
                    <h6>Ava Davis</h6>
                    <p class="mb-0">Admin<i class="fa-solid fa-chevron-down"></i></p>
                  </div>
                </div>
                <div class="custom-menu overflow-hidden">
                  <ul class="profile-body">
                    <li class="d-flex"> 
                      <svg class="svg-color">
                        <use href="../static/svg/iconly-sprite.svg#Profile"></use>
                      </svg><a class="ms-2" href="user-profile.html">Account</a>
                    </li>
                    <li class="d-flex"> 
                      <svg class="svg-color">
                        <use href="../static/svg/iconly-sprite.svg#Message"></use>
                      </svg><a class="ms-2" href="#">Inbox</a>
                    </li>
                    <li class="d-flex"> 
                      <svg class="svg-color">
                        <use href="../static/svg/iconly-sprite.svg#Document"></use>
                      </svg><a class="ms-2" href="#">Task</a>
                    </li>
                    <li class="d-flex"> 
                      <svg class="svg-color">
                        <use href="../static/svg/iconly-sprite.svg#Login"></use>
                      </svg><a class="ms-2" id="/logout">LogOut</a>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </header>

      <!-- Page Body Start-->
      <div class="page-body-wrapper"> 
        <!-- Page sidebar start-->
          {% include 'includes/sidebar.html' %}
        <!-- Page sidebar end-->

        <div class="page-body">
          <!-- Start::content pages -->
          {% block content %}{% endblock %}
          <!-- Start::content pages -->
        </div>

        {% include 'includes/footer.html' %}
      </div>
    </div>

    <!-- jquery-->
    {% include 'includes/scripts.html' %}
   <!--  <script src="{{ url_for('static', filename='add.js') }}"></script> -->

  <script>

    //delete product
    function confirmDelete(product_id) {
       Swal.fire({
          title: 'Are you sure to delete?',
          text: "You won't be able to revert this!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#2e8e87',
          cancelButtonColor: '#C42A02',
          confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
          if (result.isConfirmed) {
            document.getElementById('delete-form-' + product_id).submit();
          }
        });
    }

    //delete category
    function confirmDeleteCat(catId) {
       Swal.fire({
          title: 'Are you sure to delete?',
          text: "You won't be able to revert this!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#2e8e87',
          cancelButtonColor: '#C42A02',
          confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
          if (result.isConfirmed) {
            document.getElementById('delete-form-category-' + catId).submit();
          }
        });
    }

    // document load how flash messages with timer
    document.addEventListener('DOMContentLoaded', function() {
    setTimeout(fetchTransactions, 1000);

    const flashMessages = document.querySelectorAll('.alert');
      flashMessages.forEach(msg => {
        Swal.fire({
          icon: msg.classList.contains('alert-error') ? 'error' : 'success',
          title: msg.innerText,
          showConfirmButton: false,
          timer: 2000 // Show for 2 seconds
        });
      });
    });

    const d = new Date();
    let text = d.toLocaleString();
    document.getElementById("date-info").innerHTML = text;

    x = document.getElementById('form-transaction');
     if (x.style.display === "none") {
      x.style.display = "block";
       } else {
        x.style.display = "none";
    }


  </script>

  <!-- JS Transaction search product -->
  <script>
      // cancel transaction
      function cancelTransaction() {
        document.getElementById("message").textContent = "";
        x = document.getElementById('form-transaction');
        x.style.display = "none";
      }

      // search form
      document.getElementById("searchForm").addEventListener("submit", function(event) {
      event.preventDefault();
      document.getElementById("message").textContent = "";
      const sku = document.getElementById("sku").value.trim();
      const resultDiv = document.getElementById("form-transaction");
      const pn = document.getElementById("product-name");
      const cp = document.getElementById("category-product");
      const pp = document.getElementById("product-price");
      const ps = document.getElementById("product-stock");

      // Fetch product details by SKU with category information
      fetch(`/search_product_with_category?sku=${encodeURIComponent(sku)}`)
          .then(response => response.json())
          .then(data => {
              if (data.error) {
                  // Clear previous result
                  resultDiv.style.display = "none";
                  document.getElementById("message").innerHTML = `
                    <span class="mt-4 badge badge-danger label-square">
                          <p id="error" class="f-12">${data.error}</p>
                    </span>
                  `;
              } else {
                  resultDiv.style.display = "block";
                  pn.innerHTML = `<b> ${data.product_name} </b> `;
                  cp.innerHTML = ` ${data.category_name} `;
                  pp.innerHTML = ` ${data.price.toFixed(2)} `;
                  ps.innerHTML = ` ${data.stock} `;
                  document.getElementById("product_id").val = ` ${data.id} `;
              }
          })
          .catch(error => {
              console.error("Error fetching product:", error);
              resultDiv.innerHTML = `<p id="error">An error occurred while fetching the product details.</p>`;
          });
    });
  </script>

  <!-- Transaction FORM -->
  <script>
    document.getElementById("transactionForm").addEventListener("submit", function(event) {
      event.preventDefault();
      const productId = document.getElementById("product_id").val;
      const quantity = document.getElementById("quantity").value;
      fetch("/transaction", {
          method: "POST",
          headers: {
              "Content-Type": "application/json"
          },
          body: JSON.stringify({
              product_id: parseInt(productId),
              quantity: parseInt(quantity)
          })
      })
      .then(response => response.json())
      .then(data => {
      setTimeout(fetchTransactions, 1000);
          const messageDiv = document.getElementById("message");
          if (data.error) {
              messageDiv.style.color = "red";
              messageDiv.textContent = `Error: ${data.error}`;
          } else {
              messageDiv.style.color = "green";
              messageDiv.textContent = `Success: ${data.message}`;
          }
      })
      .catch(error => console.error("Error:", error));
    });
  </script>

  <!-- GET Transaction to show in table -->
  <script>
   function fetchTransactions() {
    const tableBody = document.getElementById("transactionsBody");
    fetch("/transactions")
        .then(response => response.json())
        .then(data => {
            console.log(data)
            tableBody.textContent  = ""; // Clear any existing rows

            data.forEach(transaction => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td data-label="Transaction Date">${new Date(transaction.transaction_date).toLocaleString()}</td>
                    <td data-label="Product Name">${transaction.product_name}</td>
                    <td data-label="Quantity">${transaction.quantity}</td>
                    <td data-label="Total Price">Rp. ${transaction.total_price.toFixed(2)}</td>
                    <td>
                      <ul class="action text-center">
                        <li class="delete "><a href="#"><i class="icon-trash"></i></a></li>
                      </ul>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        })
        .catch(error => {
            console.error("Error fetching transactions:", error);
        });
    }

  </script>

  </body>

</html>